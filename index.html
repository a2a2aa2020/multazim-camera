<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ù†Ø¸Ø§Ù… Ù…Ù„ØªØ²Ù… â€” Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠ</title>

  <style>
    :root {
      --primary: #0052CC;
      --secondary: #2C3E50;
      --accent: #27AE60;
      --danger: #E74C3C;
      --bg-white: #FFFFFF;
      --bg-light: #F8FAFC;
      --border: #E2E8F0;
      --text-main: #1E293B;
      --text-muted: #64748B;
      --safe-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg-white); color: var(--text-main); height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .login-screen { position: fixed; inset: 0; background: var(--bg-white); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px; }
    .brand { text-align: center; margin-bottom: 30px; }
    .brand .logo { width: 60px; height: 60px; background: var(--primary); border-radius: 14px; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 30px; font-weight: 900; margin-bottom: 15px; }
    
    .login-card { width: 100%; max-width: 380px; padding: 25px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
    .input-group { margin-bottom: 20px; }
    .input-group label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; color: var(--text-muted); }
    .input-group input { width: 100%; padding: 14px; border-radius: 8px; border: 1.5px solid var(--border); background: var(--bg-light); font-size: 16px; outline: none; }

    /* Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
    .stage { flex: 1; position: relative; background: #000; overflow: hidden; }
    #video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
    #overlay { position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; }

    .controls-panel { background: var(--bg-white); border-top: 1px solid var(--border); padding: 20px 20px calc(20px + var(--safe-bottom)); z-index: 20; }
    .type-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 20px; scrollbar-width: none; }
    .type-btn { border: 1.5px solid var(--border); background: var(--bg-white); color: var(--text-muted); padding: 10px 20px; border-radius: 10px; font-size: 13px; font-weight: 600; white-space: nowrap; cursor: pointer; }
    .type-btn.active { border-color: var(--primary); color: var(--primary); background: #F0F7FF; }

    .action-row { display: flex; align-items: center; justify-content: space-between; }
    .btn-capture { width: 72px; height: 72px; border-radius: 50%; background: var(--primary); border: 4px solid #E0E7FF; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .btn-sub { width: 48px; height: 48px; border-radius: 12px; background: var(--bg-light); border: 1px solid var(--border); cursor: pointer; }

    /* Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ */
    .report-modal { position: fixed; inset: 0; background: var(--bg-white); z-index: 2000; display: none; flex-direction: column; padding: 20px; overflow-y: auto; }
    .report-modal.active { display: flex; }
    .report-header { text-align: center; padding: 20px 0; border-bottom: 2px solid var(--bg-light); }
    .status-badge { display: inline-block; padding: 8px 20px; border-radius: 30px; font-weight: 800; margin: 15px 0; font-size: 14px; }
    .status-pass { background: #E8F5E9; color: var(--accent); }
    .status-fail { background: #FDEDEC; color: var(--danger); }
    
    .report-section { background: var(--bg-light); border-radius: 12px; padding: 15px; margin-top: 15px; border: 1px solid var(--border); }
    .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 13px; }
    .guidance-box { margin-top: 15px; padding: 15px; border-radius: 12px; border-right: 5px solid; line-height: 1.6; }
    .guidance-fail { background: #FFF5F5; border-right-color: var(--danger); color: #852d2d; }
    .guidance-pass { background: #F0FFF4; border-right-color: var(--accent); color: #235e39; }

    .btn-group { margin-top: auto; padding-top: 20px; display: grid; gap: 10px; }
    .btn-main { background: var(--primary); color: #fff; border: none; padding: 16px; border-radius: 12px; font-weight: 700; width: 100%; }
    .btn-outline { background: none; border: 1.5px solid var(--border); color: var(--text-muted); padding: 14px; border-radius: 12px; width: 100%; }
  </style>
</head>
<body>

  <div id="loginScreen" class="login-screen">
    <div class="brand">
      <div class="logo">Ù…</div>
      <h2>Ù†Ø¸Ø§Ù… Ù…Ù„ØªØ²Ù… Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠ</h2>
    </div>
    <div class="login-card">
      <div class="input-group">
        <label>Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
        <input type="number" id="crNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„...">
      </div>
      <button onclick="launchApp()" class="btn-main">Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ</button>
    </div>
  </div>

  <div id="stage" class="stage" style="display: none;">
    <video id="video" autoplay playsinline muted></video>
    <canvas id="overlay"></canvas>
  </div>

  <div id="controls" class="controls-panel" style="display: none;">
    <div class="type-scroll" id="typeSelector">
      <button class="type-btn active" data-type="4.5">ğŸ“ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ 4.5</button>
      <button class="type-btn" data-type="4.7">ğŸŒ¬ï¸ Ø§Ù„ØªÙ‡ÙˆÙŠØ© 4.7</button>
      <button class="type-btn" data-type="5.8">ğŸ—‘ï¸ Ø§Ù„Ù†ÙØ§ÙŠØ§Øª 5.8</button>
      <button class="type-btn" data-type="defects">ğŸ” Ø§Ù„Ø¹ÙŠÙˆØ¨</button>
    </div>
    <div class="action-row">
      <button class="btn-sub" onclick="switchCam()">ğŸ”„</button>
      <button class="btn-capture" onclick="processResult()"></button>
      <button class="btn-sub" onclick="location.reload()">âœ•</button>
    </div>
  </div>

  <div id="reportModal" class="report-modal">
    <div class="report-header">
      <h2 id="reportTitle">ØªÙ‚Ø±ÙŠØ± ÙØ­Øµ Ù…ÙŠØ¯Ø§Ù†ÙŠ</h2>
      <div id="statusBadge" class="status-badge"></div>
    </div>

    <div class="report-section">
      <div class="report-grid">
        <div><span style="color:var(--text-muted)">Ø§Ù„Ø³Ø¬Ù„:</span> <br><b id="resCR"></b></div>
        <div><span style="color:var(--text-muted)">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> <br><b id="resDate"></b></div>
        <div style="grid-column: span 2;"><span style="color:var(--text-muted)">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ:</span> <br><b id="resLoc"></b></div>
      </div>
    </div>

    <div id="guidanceBox" class="guidance-box"></div>

    <div class="btn-group">
      <button class="btn-main" onclick="location.reload()">Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
      <button class="btn-outline" onclick="document.getElementById('reportModal').classList.remove('active')">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ</button>
    </div>
  </div>

<script>
  let stream, currentType = '4.5', coords = "24.7136, 46.6753";

  // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ´Ù„
  const guidanceMap = {
    '4.5': {
      fail: "ÙŠØ¬Ø¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† Ù„ØªÙƒÙˆÙ† Ù…Ù†Ø­Ù†ÙŠØ© (Coved) Ø¨Ù…Ù‚Ø¯Ø§Ø± 4.5 Ø³Ù… Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªÙ†Ø¸ÙŠÙ ÙˆÙ…Ù†Ø¹ ØªØ±Ø§ÙƒÙ… Ø§Ù„Ø£ØªØ±Ø¨Ø© ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ø§Ø´ØªØ±Ø§Ø·Ø§Øª Ø§Ù„ØµØ­ÙŠØ©.",
      pass: "Ø§Ù†Ø­Ù†Ø§Ø¡ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ÙÙ†ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©."
    },
    '4.7': {
      fail: "Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‡ÙˆÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙ Ø£Ùˆ ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØªØ­Ø§Øª ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚. ÙŠØ¬Ø¨ ØªØ±ÙƒÙŠØ¨ Ø´ÙØ§Ø·Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ÙˆØ¶Ù…Ø§Ù† ØªØ¯ÙÙ‚ Ø§Ù„Ù‡ÙˆØ§Ø¡ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø±Ø·ÙˆØ¨Ø© ÙˆØ§Ù„Ø±ÙˆØ§Ø¦Ø­.",
      pass: "ØªÙˆØ²ÙŠØ¹ ÙˆÙ†Ø¸Ø§ÙØ© ÙØªØ­Ø§Øª Ø§Ù„ØªÙ‡ÙˆÙŠØ© Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù„Ø§Ø¦Ø­Ø©."
    },
    '5.8': {
      fail: "Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù†ÙØ§ÙŠØ§Øª Ù„Ø§ ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±. ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø§ÙˆÙŠØ§Øª ØªÙØªØ­ Ø¨Ø§Ù„Ù‚Ø¯Ù…ØŒ Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ØŒ ÙˆÙ…ØµÙ†ÙˆØ¹Ø© Ù…Ù† Ù…ÙˆØ§Ø¯ Ø³Ù‡Ù„Ø© Ø§Ù„ØªÙ†Ø¸ÙŠÙ.",
      pass: "Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙØ§ÙŠØ§Øª ÙˆØ§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ù…Ø³ØªÙˆÙÙŠ Ù„Ù„Ø´Ø±ÙˆØ·."
    },
    'defects': {
      fail: "ØªÙ… Ø±ØµØ¯ Ø¹ÙŠÙˆØ¨ Ø¥Ù†Ø´Ø§Ø¦ÙŠØ© (ØªØ´Ù‚Ù‚Ø§Øª/Ù‡Ø¨ÙˆØ·). ÙŠØ¬Ø¨ Ø¹Ù…Ù„ ØµÙŠØ§Ù†Ø© ÙÙˆØ±ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¦ÙŠØ© ÙˆÙ…Ù†Ø¹ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­Ø´Ø±Ø§Øª.",
      pass: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙŠÙˆØ¨ Ø¥Ù†Ø´Ø§Ø¦ÙŠØ© Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙØ­Øµ."
    }
  };

  async function launchApp() {
    if (!document.getElementById('crNumber').value) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¬Ù„ Ø£ÙˆÙ„Ø§Ù‹");
    if (navigator.geolocation) navigator.geolocation.getCurrentPosition(p => coords = `${p.coords.latitude.toFixed(5)}, ${p.coords.longitude.toFixed(5)}`);
    
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
    document.getElementById('video').srcObject = stream;
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('stage').style.display = 'block';
    document.getElementById('controls').style.display = 'block';
    
    const c = document.getElementById('overlay');
    c.width = c.clientWidth * window.devicePixelRatio;
    c.height = c.clientHeight * window.devicePixelRatio;
    draw();
  }

  function draw() {
    const c = document.getElementById('overlay'), ctx = c.getContext('2d');
    const w = c.width, h = c.height, dpr = window.devicePixelRatio;
    ctx.clearRect(0, 0, w, h);
    ctx.strokeStyle = '#0052CC'; ctx.lineWidth = 3 * dpr; ctx.setLineDash([10, 10]);
    
    if(currentType === '4.5') { ctx.beginPath(); ctx.moveTo(w/2, h/2-80*dpr); ctx.arcTo(w/2, h/2, w/2+80*dpr, h/2, 80*dpr); ctx.stroke(); }
    else if(currentType === '4.7') ctx.strokeRect(w/2-100*dpr, h/2-50*dpr, 200*dpr, 100*dpr);
    else if(currentType === '5.8') { ctx.beginPath(); ctx.arc(w/2, h/2, 80*dpr, 0, Math.PI*2); ctx.stroke(); }
    requestAnimationFrame(draw);
  }

  function processResult() {
    // Ù…Ø­Ø§ÙƒØ§Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ (ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    // Ù‡Ù†Ø§ Ù†Ø¬Ø¹Ù„Ù‡Ø§ ØªØ³Ø£Ù„ Ø§Ù„Ù…ÙØªØ´ Ø¨Ø¨Ø³Ø§Ø·Ø© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ
    const isSuccess = confirm("Ù‡Ù„ Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ±ØŸ");
    showReport(isSuccess);
  }

  function showReport(isSuccess) {
    document.getElementById('resCR').innerText = document.getElementById('crNumber').value;
    document.getElementById('resDate').innerText = new Date().toLocaleString('ar-SA');
    document.getElementById('resLoc').innerText = coords;

    const badge = document.getElementById('statusBadge');
    const gBox = document.getElementById('guidanceBox');

    if (isSuccess) {
      badge.innerText = "ÙØ­Øµ Ù†Ø§Ø¬Ø­ - Ù…Ø·Ø§Ø¨Ù‚";
      badge.className = "status-badge status-pass";
      gBox.className = "guidance-box guidance-pass";
      gBox.innerHTML = "<b>Ø§Ù„ØªÙˆØ¬ÙŠÙ‡:</b> " + guidanceMap[currentType].pass;
    } else {
      badge.innerText = "ÙØ­Øµ ØºÙŠØ± Ù†Ø§Ø¬Ø­ - Ù…Ù„Ø§Ø­Ø¸Ø§Øª";
      badge.className = "status-badge status-fail";
      gBox.className = "guidance-box guidance-fail";
      gBox.innerHTML = "<b>Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ÙÙ†ÙŠ:</b> " + guidanceMap[currentType].fail;
    }

    document.getElementById('reportModal').classList.add('active');
  }

  document.getElementById('typeSelector').onclick = (e) => {
    const b = e.target.closest('.type-btn');
    if(!b) return;
    currentType = b.dataset.type;
    document.querySelectorAll('.type-btn').forEach(x => x.classList.remove('active'));
    b.classList.add('active');
  };

  async function switchCam() {
    stream.getTracks().forEach(t => t.stop());
    launchApp();
  }
</script>
</body>
</html>
